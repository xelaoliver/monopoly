<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Alex Oliver's Monopoly</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    h1 {
      line-height: 0%;
      size: large;
    }

    a {
      text-decoration: none;
    }

    * {
      box-sizing: border-box;
    }

    .container {
      display: grid;
      grid-template-areas: "left center right";
      grid-template-columns: 225px 1fr 225px;
      gap: 7px;
      width: calc(100% - 400px);
      margin: auto;
    }

    .name {
      padding: 7px;
      margin: -7px;
      width: 106.75%;
    }

    .left, .center, .right {
      border: 1px solid #cecece;
      padding: 7px;
    }

    .left {
      grid-area: left;
    }

    .center {
      grid-area: center;
    }

    .right {
      grid-area: right;
    }
  </style>
</head>

<body>
  <script>
    const socket = io("http://localhost:5000");
    offonline = true;

    socket.on("connect", () => {
      console.log("yay. server is connected to client!");
      socket.send("game");
      if (((window.innerWidth <= 800) && (window.innerHeight <= 600))) {
        document.getElementById("offonline").innerHTML = 'This site requires you to have a keyboard/mouse and a display larger than 800x600px.';
      } else {
        document.getElementById("offonline").innerHTML = 'Name: <input type="text" id="name" autocomplete="off"> <button onclick="join()">Join</button><br><br>The server is <span style="color: green;">online</span>';
      }
    });

    socket.on("connect_error", (err) => {
      console.log("uh oh. client is not connected.");
    });

    socket.on("message", (msg) => {
      console.log(msg);

      if (msg[0] == "game" && offonline) {
        if (msg[1]) {
          document.getElementById("offonline").innerHTML = 'The server is <span style="color: green;">online</span>, but a game is already in play.<br>Please wait until the game ends.';
          console.log("game already in play");
        } else {
          document.getElementById("offonline").innerHTML += ' and players will be waiting in the lobby.';
          console.log("free game availaible");
        }
        offonline = false;
      } else if (msg[0] == "msg") {
        document.getElementById("log").innerHTML = `${msg[1]}: ${msg[2].replace("\n", "<br>")}<br>`+document.getElementById("log").innerHTML;
      } else if (msg[0] == "leave") {
        document.getElementById("log").innerHTML = `<span style="color: maroon;">${msg[1]} has left the game.</span><br>`+document.getElementById("log").innerHTML;
      } else if (msg[0] == "join") {
        document.getElementById("player-number").innerHTML = msg[2].length;

        document.getElementById("player-list").textContent = "";
        for (let i = 0; i < msg[2].length; i++) {
          const client = document.createElement("li");
          client.textContent = msg[2][i];
          client.id = msg[2][i];
          document.getElementById("player-list").appendChild(client);
        }

        document.getElementById("log").innerHTML = `<span style="color: maroon;">${msg[1]} has joined the game.</span><br>`+document.getElementById("log").innerHTML;
      }

      document.getElementById("log").scrollTop = 0;
    });

    function join() {
      name = document.getElementById("name").value;
      if (name == "") {
        return;
      }

      socket.send(["join", name]);
      document.getElementById("home").style.display = "none";
      document.getElementById("game").style.display = "grid";
    }

    function sendMessage() {
      msg = document.getElementById("message").value;
      if (msg == "") {
        return;
      }

      socket.send(["msg", name, msg]);
      document.getElementById("message").value = "";
    }
  </script>
</body>
<div style="text-align: center;" id="home">
<!-- <div style="text-align: center; display: none;" id="home"> -->
  Alex Oliver's<br>
  <h1>Monopoly</h1><br>

  <p><span id="offonline">The server is <span style="color: red;">offline</span>, run it on your WiFi network by
      downloading <a href="https://github.com/xelaoliver/monopoly/blob/main/version-3/server.py" target="_blank">my
        server</a>,<br>or ask someone with the server to turn it online.</span></p>
</div>

<div id="game" class="container" style="display: none;">
<!-- <div id="game" class="container"> -->
  <div class="left">
    <div class="name" style="background-color: #fce1f4;"><u>Game Information</u></div><br>
    Player List (<span id="player-number"></span>):
    <ul id="player-list"></ul>
  </div>
  <div class="center">
    the board/trade window. where the fun visuals and exciting trading will take place!
  </div>
  <div class="right">
    <div class="name" style="background-color: #ffdeac;">
      <u>Chat and Game Log</u>
      <input id="message" type="text" style="width: 100%; margin-top: 8px;"><br><button onclick="sendMessage()" style="margin-top: 8px;">Send</button>
    </div><br>
    <div id="log" style="overflow: auto; height: 100%; margin-top: -4px;"></div>
  </div>
</div>
</html>
